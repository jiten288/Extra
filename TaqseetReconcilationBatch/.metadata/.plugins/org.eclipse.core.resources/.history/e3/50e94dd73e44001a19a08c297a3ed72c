package com.reconcile;

import java.sql.Connection;
import java.sql.SQLException;
import java.util.List;

import org.apache.log4j.BasicConfigurator;
import org.apache.log4j.Logger;
import org.apache.log4j.PropertyConfigurator;

public class TaqseetReconcileUtillity {
	static Logger logger = Logger.getLogger(TaqseetReconcileUtillity.class);

	public static void main(String[] batchParam) throws SQLException {

		BasicConfigurator.configure();
		String log4jConfigFile = (PosServiceUtil.class.getResource("/log4j.properties")).getPath();
		PropertyConfigurator.configure(log4jConfigFile);

		String method = batchParam[0];
		String filepath = batchParam[1];

		PosServiceUtil service = new PosServiceUtil();
		if (method != null && !method.isEmpty() && method.equalsIgnoreCase("date")) {
			logger.info("Call the Date Query" + method);

			DBManager dbManager = DBManager.getInstance();
			List<CancelledTransactionDAO> cancelledTrans = dbManager.getCancelledTransactionByDate();
			// service.getTransactionStatus("2731174062");
			// service.callPostTransactionReversal("1033660802", 2.25 , 132645, "2731174062");

			for (CancelledTransactionDAO cancelledTransaction : cancelledTrans) {
				String transactionStatus = service.getTransactionStatus(cancelledTransaction.getCivilId());
				if(transactionStatus != null && transactionStatus.equalsIgnoreCase("OK")){
				service.callPostTransactionReversal(cancelledTransaction.getCivilId(),cancelledTransaction.getReverseAmt()
						, cancelledTransaction.getOtp(), cancelledTransaction.getRetailRefNo());
				}
			}

		} else if (method != null && !method.isEmpty() && filepath != null && !filepath.isEmpty()
				&& method.equalsIgnoreCase("tran")) {
			logger.info("Call the trans Query  " + method + " " + filepath);
			DBManager dbManager = DBManager.getInstance();
			List<CancelledTransactionDAO> cancelledTrans = dbManager.getCancelledTransactionByTrans();
			// service.getTransactionStatus("2731174062");
			// service.callPostTransactionReversal("1033660802", 2.25 , 132645, "2731174062");

			for (CancelledTransactionDAO cancelledTransaction : cancelledTrans) {
				String transactionStatus = service.getTransactionStatus(cancelledTransaction.getCivilId());
				if(transactionStatus != null && transactionStatus.equalsIgnoreCase("OK")){
				service.callPostTransactionReversal(cancelledTransaction.getCivilId(),cancelledTransaction.getReverseAmt()
						, cancelledTransaction.getOtp(), cancelledTransaction.getRetailRefNo());
				}
			}
			
		} else {
			logger.info("Invalid Or No paramters passed");
		}
	}
}
